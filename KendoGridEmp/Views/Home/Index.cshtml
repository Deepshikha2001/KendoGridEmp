@model KendoGridEmp.Models.Employee
<link rel="stylesheet" href="https://kendo.cdn.telerik.com/themes/7.0.2/default/default-main.css" />
@* <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.9.2/jquery.contextMenu.min.css">
 *@
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

@* <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.9.2/jquery.contextMenu.min.js"></script>
 *@<script src="https://kendo.cdn.telerik.com/2023.2.829/mjs/kendo.all.js" type="module"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"></script>
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.8.0/jquery.contextMenu.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.8.0/jquery.contextMenu.min.js"></script>


<style>  
    #editBtn {
        padding: 3px 13px;
       border: none;
        border-radius: 50%;
        background: lightgray;
        font-size: 16px;
    }
</style>

<div id="container">
   
    <button type="button" id="addBtn" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
        Add New Record
    </button>   

   
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel"></h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                 
                    <form id="myForm">
                        <div class="form-group">
                            <input type="hidden" asp-for="Id" class="form-control" id="Id" name="Id">
                        </div>
                        <div class="form-group">
                            <label for="Name">Name</label>
                            <input type="text" class="form-control" id="Name" name="Name">
                        </div>
                        <div class="form-group">
                            <label for="Age">Age</label>
                            <input type="number" class="form-control" id="Age" name="Age">
                        </div>
                        <div class="form-group">
                            <label for="Contact">Contact</label>
                            <input type="number" class="form-control" id="Contact" name="Contact">
                        </div>
                        <div class="form-group">
                            <label for="Designation">Designation</label>
                            <input type="text" class="form-control" id="Designation" name="Designation">
                        </div>
                        <div class="form-group">
                            <input type="hidden" asp-for="CategoryId" class="form-control" id="CategoryId" name="CategoryId">
                        </div>
                        <div class="form-group">
                            <label for="Categories">Category</label>
                            <input type="text" class="form-control" id="Categories" name="Categories">
                        </div>
                      @*   <div class="form-group">
                            <label for="CategoryId">Category</label>
                            <input type="text" class="form-control" id="CategoryId" name="CategoryId">
                        </div> *@
                      
                    </form>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" id="saveBtn" class="btn btn-primary">Save</button>
                </div>
            </div>
        </div>
    </div>

    <div id="example">
        <div id="grid"></div>
    </div>   
</div>

<script>
    $(document).ready(function () {
        $("#Categories").kendoDropDownList({
            dataTextField: "name",
            dataValueField: "categoryId", 
            dataSource: {
                transport: {
                    read: {
                        url: "/Emp/GetCategories",
                        dataType: "json"
                    }
                }
            },
            change: function (e) {
                var value = this.value();
                var text = this.text();
                $("#CategoryId").val(value);
                $("#CategoryName").text(text);
            }
        });

      
        var grid = $("#grid").kendoGrid({
            dataSource: {

                transport: {
                    read: {
                        url: "/Emp/GetData",
                        type: "json",
                    }
                },
                pageSize: 20
            },
            height: 550,
           
            sortable: true,
            pageable: {
                refresh: true,
                pageSizes: true,
                buttonCount: 5
            },
           
           
           
            columns: [
                { field: "id", title: "Id" },
                { field: "name", title: "Name" },
                { field: "age", title: "Age" },
                { field: "contact", title: "Contact" },
                { field: "designation", title: "Designation" },
                // { field: "catgeories.CategoryId", title: "" },
                { field: "categories.categoryName", title: "Category" },
                {
                    field: "CustomColumn", title: "Action", width: "75",
                    template: '<button type="button" id="editBtn" class="myMenu "><i class="fa-solid fa-ellipsis-vertical"></i></button>',
                },
            ]
        }).data("kendoGrid");

       
        // Create
        $("#saveBtn").click(function () {
            var formData = $("#myForm").serialize();
            var categoryId = $("#Categories").data("kendoDropDownList").value();
            var url;
            var id = $("#Id").val();
            if (id > 0) {
                url = "/Emp/Edit?id=" + id + "&categoryId=" + categoryId;
            }
            else {
                url = "/Emp/Create?categoryId=" + categoryId;
            }
            console.log("Category ID:", categoryId);

            if (categoryId) {
                $("#CategoryId").val(categoryId);

                $.ajax({
                    type: "post",
                    url: url,
                    data: formData,
                    success: function (d) {
                        console.log(d);
                        $("#staticBackdrop").modal("hide");
                        grid.dataSource.read();
                    }
                });
            } else {
                console.error("Category ID is undefined or empty.");
            }
        });

      



        $("#addBtn").click(function () {
              $("#myForm")[0].reset();

            $(".modal-header h1").text("Add New");
        })
      
        $.contextMenu({            
            selector: ".myMenu",
            autoHide: true,
            trigger: "left",
            
            items: {
                Edit: {
                    name: "Edit", callback: function (key, opt) {

                        $(".modal-header h1").text("Edit");
                        $("#staticBackdrop").modal("show");
                        var gridData = grid.dataItem($(this).closest("tr"));
                        $("#Id").val(gridData.id);
                        $("#Name").val(gridData.name);
                        $("#Age").val(gridData.age);
                        $("#Contact").val(gridData.contact);                       
                        $("#Designation").val(gridData.designation);

                        console.log(gridData);

                    }
                },

                Delete: {
                    name: "Delete",
                    callback: function (key, opt) {
                        var gridData = grid.dataItem($(this).closest("tr"));
                        var rowId = gridData.id; 
                        console.log(rowId);
                        $.ajax({
                            type: "post",
                            url: "/Emp/Delete/" + rowId, 
                            success: function (d) {
                                console.log(d);
                                grid.dataSource.read();
                            }
                        })
                    }
                }

            }
        });
    });
</script>

